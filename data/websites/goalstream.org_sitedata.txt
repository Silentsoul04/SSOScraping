{"link":"goalstream.org","html":"<head><style type=\"text/css\">@charset \"UTF-8\";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>\n    <meta charset=\"utf-8\">\n    <title>Sports social network Goalstream</title>\n    <script type=\"text/javascript\" async=\"\" defer=\"\" src=\"//app.goalstream.org/piwik.js\"></script><script type=\"text/javascript\" src=\"/externals/_app/langs/en.js?v=2.0.0-380\"></script>\n\n    <script type=\"text/javascript\" src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\" async=\"\"></script>\n\n    <meta name=\"description\" content=\"Stay in touch with the sports tournaments in your town, join your own team and participate in player ratings on Goalstream!\"><meta name=\"keywords\" content=\"Goalstream, football championship, football tournament, football competition, football statistics, amateur football, amateur soccer, football league, player rating, find a team, site for team\"><meta name=\"og:image\" content=\"/public/admin/logo4.png\"><meta name=\"og:title\" content=\"Спортивная социальная сеть — Goalstream\"><meta name=\"og:description\" content=\"Создай страницу своей команды, участвуй в турнирах, живи футболом — от профи до дворового — на www.goalstream.org\">\n<link rel=\"stylesheet\" href=\"/application/themes/goalstream/css/style.css?v=2.0.0-380\" media=\"screen,projection\">\n\n<!--[if IE 9]>\n<link rel=\"stylesheet\" href=\"/application/themes/goalstream/css/ie9.css?v=2.0.0-380\" media=\"screen,projection\">\n\n<![endif]--><!--[if IE 8]>\n<link rel=\"stylesheet\" href=\"/application/themes/goalstream/css/ie8.css?v=2.0.0-380\" media=\"screen,projection\">\n\n<![endif]--><!--[if lte IE 7]>\n<link rel=\"stylesheet\" href=\"/application/themes/goalstream/css/ie7.css?v=2.0.0-380\" media=\"screen,projection\">\n\n<![endif]-->\n<link rel=\"stylesheet\" href=\"/application/themes/goalstream/css/common.css?v=2.0.0-380\">\n\n\n<link rel=\"stylesheet\" href=\"/externals/jquery/jquery.ui/datepicker.min.css?v=2.0.0-380\">\n\n<script src=\"/externals/jquery/jquery.min.js?v=2.0.0-380\"></script><script src=\"/externals/jquery/jquery.modules.min.js?v=2.0.0-380\"></script><script src=\"/externals/jquery/jquery.autocomplete.min.js?v=2.0.0-380\"></script><script src=\"/externals/jquery/jquery.misc.js?v=2.0.0-380\"></script><script src=\"/externals/jquery/jquery.ui/datepicker.min.js?v=2.0.0-380\"></script><script src=\"/externals/angular-1.5.8/angular.min.js?v=2.0.0-380\"></script><script src=\"/externals/_app/modules/modules.js?v=2.0.0-380\"></script><script src=\"/externals/_app/modules/core/directives.js?v=2.0.0-380\"></script><script src=\"/externals/_app/modules/core/controllers/LoginCtrl.js?v=2.0.0-380\"></script><script src=\"/externals/_app/modules/core/controllers/SignupCtrl.js?v=2.0.0-380\"></script><script src=\"http://api-maps.yandex.ru/2.0/?load=package.map&amp;lang=en-US&amp;v=2.0.0-380\"></script><script src=\"/externals/_app/pages/index.js?v=2.0.0-380\"></script><script src=\"http://api-maps.yandex.ru/2.0/?load=package.map&amp;lang=en-US&amp;v=2.0.0-380\"></script><script src=\"/application/modules/User/externals/scripts/vk2.js?v=2.0.0-380\"></script><script>var vkAppId = 3213199</script></head>\n<body onresize=\"onBodyResize()\">\n    <div class=\"scroll_fix_wrap\" id=\"page_wrap\">\n        <div class=\"scroll_fix\" style=\"width: 784px;\">\n\n                        <div id=\"wrapper\">\n                <div id=\"container\" class=\"b-page__dummy cf operaFix100\">    <header class=\"b-header cf\">\n        <form ng-controller=\"MainLoginCtrl\" class=\"b-header__login ng-pristine ng-scope ng-invalid ng-invalid-required\" action=\"/login\" method=\"post\">\n    <div class=\"form_group\">\n        <input type=\"text\" id=\"login_email\" name=\"email\" ng-model=\"email\" placeholder=\"Email/phone\" class=\"login_field ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required\" required=\"\">\n        <label for=\"login_email\"><span class=\"smart_label\">Email/phone</span></label>\n    </div><!--\n    --><div class=\"form_group\">\n        <input type=\"password\" id=\"login_pass\" name=\"password\" ng-model=\"password\" placeholder=\"Password\" class=\"login_field ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required\" required=\"\">\n        <label for=\"login_pass\"><span class=\"smart_label\">Password</span></label>\n        <span class=\"password__forgot\" id=\"remind_pass\" data-original-title=\"\" title=\"\">Remind me</span>\n    </div><!--\n    --><div class=\"form_group\" style=\"padding-top: 22px\">\n        <button class=\"submit\" type=\"submit\" id=\"login-btn\" data-loading-text=\"Wait...\" autocomplete=\"off\" style=\"width: 100px;\">Log In</button><!--\n        --><button class=\"vk\" type=\"submit\" id=\"vk-login-btn\" style=\"width: 40px;\"></button>\n    </div>\n\n    <input type=\"hidden\" name=\"return_url\" value=\"/\" id=\"return_url\">\n</form>\n\n\n\n\n\n\n\n\n<script type=\"text/javascript\">\n    $(function() {\n        $(\"#vk-login-btn\").on(\"click\", function(e) {\n            e.preventDefault();\n            $(document).trigger(\"vk.login.click\");\n        });\n    });\n</script><a class=\"b-header__logo\" href=\"/\"></a>    </header>\n<div class=\"b-reg\">\n    <h2 class=\"b-reg__overlay\" id=\"entity_name\">Clubs and <br>persons</h2><div class=\"b-reg__goto\"><div class=\"wrapper\" style=\"font-size : 17px;\">\n    Join your team! Discover your city sports tournaments!<a href=\"#signup-modal\" data-toggle=\"modal\" onclick=\"window._paq ? window._paq.push([&quot;Registration&quot;, &quot;Registration Popup Open&quot;, &quot;Registration Popup Open From Landing&quot;]) : void(0)\" class=\"b-btnSimple\">Join now</a><div class=\"more\">\n    <a href=\"/help/agreement\">User agreement</a><a href=\"/help/offer\">Offer</a></div></div><div class=\"card\">\n    <a href=\"#signup-modal\" data-toggle=\"modal\" onclick=\"window._paq ? window._paq.push(['Registration', 'Registration Popup Open', 'Registration Popup Open From Landing By Code']) : void(0);\">Registration by code</a>\n</div></div><div class=\"b-reg__info\" data-type=\"team\"><div class=\"b-home-gs-info\">\n    <h3 class=\"title\">Goalstream — это 790 510 игроков и 80 413 команд!</h3>\n    <p>Тысячи соревнований, трансферный рынок<br><span class=\"shift\">и уютный дом для вашей команды!</span></p></div></div><div class=\"b-reg__info\" data-type=\"champ\" style=\"display: none;\"><div class=\"b-home-gs-info\">\n    <h3 class=\"title\">Мобильное приложение Goalstream</h3>\n    <p style=\"padding-right:0\">Получайте оповещения о новых событиях в турнирах<br><span class=\"shift\">и проводите сборы команды на игры!</span></p></div></div><div class=\"b-reg__info\" data-type=\"fans\" style=\"display: none;\"><div class=\"b-home-gs-info\">\n    <h3 class=\"title\">Крупнейшая площадка любительского спорта</h3>\n    <p style=\"padding-right:0\">Автоматизированная система статистики, <br><span class=\"shift\">социальные сервисы, интерактив, монетизация</span></p></div></div></div><div class=\"b-main cf\" role=\"main\">\n    <div class=\"b-popular\">\n    <h2 class=\"b-popular__title\" style=\"font-size : 50px\">Карта спорта</h2><ul class=\"b-home-entities\">\n    <li class=\"b-home-entities__item team b-home-entities__item_state_active b-home-entities__item_type_team\" data-type=\"team\" data-bg=\"/application/themes/goalstream/img/css/bg.jpg\">\n    <a class=\"b-home-entities__link\" href=\"#\">Командам и<br>игрокам</a></li> <li data-type=\"champ\" data-bg=\"/application/themes/goalstream/img/css/bg_stadium.jpg\" class=\"b-home-entities__item b-home-entities__item_type_champ\">\n    <a class=\"b-home-entities__link\" href=\"#\">В онлайне<br>со спортом</a></li> <li data-type=\"fans\" data-bg=\"/application/themes/goalstream/img/css/bg_fans.jpg\" class=\"b-home-entities__item b-home-entities__item_type_fans\">\n    <a class=\"b-home-entities__link\" href=\"#\">Организаторам<br>турниров</a></li>    <!--[if lte IE 7]><li class=\"after\"></li><![endif]-->\n</ul>\n\n<script type=\"text/javascript\">\n$(function(){\n    var AUTO_ACTIVATE_INTERVAL = 7000,\n        autoActivateIntervalID;\n\n    var activateNextEntity = function() {\n        var next = $(\".b-home-entities__item_state_active\").next();\n        if (next.length == 0) {\n            next = $(\".b-home-entities__item:first\");\n        }\n        $(\".b-home-entities__link\", next).trigger(\"click\", [true]);\n    };\n\n    $(\".b-home-entities__link\").on(\"click\", function(e, calledByTimer){\n        e.preventDefault();\n\n        if (!calledByTimer) {\n            clearInterval(autoActivateIntervalID);\n        }\n\n        var parent = $(this).closest(\".b-home-entities__item\"),\n            link = $(\"a\", parent);\n        if (parent.hasClass(\"b-home-entities__item_state_active\")) {\n            return;\n        }\n\n        $(\".b-home-entities__item\").removeClass(\"b-home-entities__item_state_active\");\n        parent.addClass(\"b-home-entities__item_state_active\");\n\n        $(\".b-reg__info:visible\").fadeOut(function(){\n            $(\".b-reg__info[data-type='\" + parent.data(\"type\")  + \"']\").fadeIn();\n        });\n        $(\"#home_bg\").fadeOut(function(){\n            $(this).css(\"background-image\", \"url(\" +parent.data(\"bg\") + \")\").fadeIn();\n            $(\"#entity_name\").html(link.html());\n        });\n    });\n\n    $(\".b-reg__info .more\").on(\"click\", function(e){\n        e.preventDefault();\n        activateNextEntity();\n    });\n\n\n    autoActivateIntervalID = setInterval(activateNextEntity, AUTO_ACTIVATE_INTERVAL);\n\n    $(\".b-reg__info:not(:first)\").hide();\n\n    var imagesToPreload = [\n        \"/application/themes/goalstream/img/popular_switcher/team.jpg\",\n        \"/application/themes/goalstream/img/popular_switcher/championship_active.png\",\n        \"/application/themes/goalstream/img/popular_switcher/fan_active.png\"\n    ];\n    $(\".b-home-entities__item\").each(function(i, item) {\n        imagesToPreload.push($(item).data(\"bg\"));\n    });\n    preloadImages(imagesToPreload);\n});\n</script></div><div style=\"position: relative; z-index: 2\">\n    <iframe id=\"sport-map-frame\" src=\"/gbuilding/map?type=sport_map&amp;options[]=associations&amp;options[]=matches_count&amp;options[]=geolocation&amp;zoom=5\" style=\"border: none; width: 100%; height: 500px\"></iframe>\n</div></div><footer class=\"b-footer\">\n    <a class=\"b-footer__logo\" href=\"/\"></a><span class=\"b-footer__copyright\">© 2017. All rights reserved</span><div class=\"b-footer__links\"><a href=\"/help/agreement\">User agreement</a><a href=\"/help/offer\">Offer</a><a href=\"/help/contact\">Contact</a></div></footer><div id=\"signup-modal\" class=\"modal fade\" role=\"dialog\" aria-hidden=\"true\">\n    <div class=\"modal-dialog\">\n        <div ng-controller=\"SignupCtrl\" ng-class=\"{'b-popup_reg_thanks': regDoneClass}\" class=\"b-popup-registration b-popup_reg ng-scope\" style=\"position: relative\">\n\n            <form ng-submit=\"do(user)\" name=\"userForm\" class=\"ng-pristine ng-valid\">\n                <fieldset>\n                    <div class=\"b-popup__close\" data-dismiss=\"modal\" aria-hidden=\"true\">×</div>\n\n                    <div class=\"b-popup__regBlock\">\n                        <h4 class=\"b-popup__title\">\n                            <span class=\"wrapper\">SIGN UP</span>\n                        </h4>\n\n                        <div class=\"wrapperFields cf\" ng-show=\"step == 21\">\n                            <input type=\"email\" ng-model=\"user.email\" placeholder=\"Email\" name=\"email\" id=\"reg_email\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <input type=\"password\" ng-model=\"user.password\" placeholder=\"Password\" id=\"reg_pass\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <span class=\"statusMsg\"></span>\n                            <span class=\"divider\"></span>\n                        </div>\n\n                        <div class=\"wrapperFields cf\" ng-show=\"step == 22\">\n                            <input type=\"text\" ng-model=\"user.phone\" placeholder=\"Phone\" name=\"email\" id=\"reg_phone\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <input type=\"password\" ng-model=\"user.password\" placeholder=\"Пароль из СМС\" id=\"reg_pass2\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <span class=\"statusMsg\"></span>\n                            <span class=\"divider\"></span>\n                        </div>\n\n                        <div class=\"b-popup__regThanks\" ng-show=\"step == 21\">\n                            <div class=\"title\">Thank you!</div>\n                            Чтобы убедиться что вы не робот, подвердите регистрацию нажав на ссылку в письме, которое мы вам\n                            только что отправили. Даем вам на это 3 дня.\n\n                            <div class=\"centered-wrapper\">\n                                <a class=\"b-btnSimple\" href=\"/members/home\" id=\"after-reg-link\">ПЕРЕЙТИ К САЙТУ</a>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"b-popup__body\" ng-show=\"step == 21\">\n                        <div class=\"wrapperFields cf\">\n                            <input type=\"text\" ng-model=\"user.firstName\" placeholder=\"First Name\" name=\"first_name\" id=\"reg_fname\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <input type=\"text\" ng-model=\"user.lastName\" placeholder=\"Last Name\" name=\"last_name\" id=\"reg_lname\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <span class=\"statusMsg\"></span>\n                            <span class=\"divider\"></span>\n                        </div>\n\n                        <div class=\"wrapperFields cf\">\n                            <input type=\"text\" ng-model=\"user.city.name\" placeholder=\"City, start typing\" gs-city-autocomplete=\"user.city\" id=\"reg_city\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <input type=\"text\" ng-model=\"user.birthday\" placeholder=\"Birthday\" name=\"birthday\" id=\"reg_birthday\" gs-calendar=\"{yearRange: '-85:-5', defaultDate: '-20y', dateFormat: 'dd.mm.yy'}\" class=\"ng-pristine ng-untouched ng-valid\">\n                            <span class=\"statusMsg\"></span>\n                            <span class=\"divider\"></span>\n                        </div>\n\n                        <div ng-show=\"loadingVkProfile\" style=\"display: inline; color: #eee; float: right; height: 39px; line-height: 39px; margin-right: 140px\">Loading...</div>\n\n                        <a class=\"b-btnVk\" href=\"\" ng-click=\"getVkProfile()\">\n                            Take profile from<span class=\"ico\"></span>\n                        </a>\n\n                        <div id=\"reg_message\" class=\"hide alert alert-danger\" style=\"margin-top:1.5em;margin-bottom:0\"></div>\n\n                        <div style=\"height:2px;background-color:#ccc;margin-top:2em;opacity:0.35;filter:alpha(opacity=35);\"></div>\n\n                        <div class=\"b-popup__actions\">\n                            By clicking Sign Up, you agree to our <a href=\"/help/agreement\">User agreement</a>\n                            and <a href=\"/help/offer\">Offer</a>.\n\n                            <button class=\"b-btnSubmit\" type=\"submit\" data-loading-text=\"Wait...\" autocomplete=\"off\" id=\"user-submit\">Sign Up</button>\n                        </div>\n                    </div>\n\n                    <div class=\"b-popup__body\" ng-show=\"step == 22\" style=\"padding-top: 10px\">\n                        <p style=\"color: #fff\">Введите логин и пароль, которые вы получили в СМС, и нажмите на кнопку «Далее»,\n                            чтобы получить доступ к профайлам вашего игрока и команды, если вы не получали\n                            СМС — нажмите на кнопку «Без&nbsp;СМС».</p>\n\n                        <div id=\"reg_message2\" class=\"hide alert alert-danger\" style=\"margin-top:1.5em;margin-bottom:0\"></div>\n\n                        <div style=\"height:2px;background-color:#ccc;margin-top:2em;opacity:0.35;filter:alpha(opacity=35);\"></div>\n\n                        <div class=\"b-popup__actions\" style=\"height: 30px\">\n                            <a class=\"b-btnSimple\" id=\"reg-without-sms\" ng-click=\"goToStep(21)\" style=\"color: #000; cursor: pointer; width: 180px;\">Без СМС</a>\n                            <button class=\"b-btnSubmit\" type=\"submit\" data-loading-text=\"Wait...\" autocomplete=\"off\" id=\"user-submit2\">Далее</button>\n                            <div class=\"clearfix\"></div>\n                        </div>\n                    </div>\n                </fieldset>\n                <input type=\"hidden\" id=\"start-step\" ng-model=\"step\" value=\"22\" class=\"ng-pristine ng-untouched ng-valid\">\n                <input type=\"hidden\" ng-model=\"user.cityId\" required=\"required\" class=\"ng-pristine ng-untouched ng-valid\">\n                <input type=\"hidden\" ng-model=\"user.nationId\" required=\"required\" class=\"ng-pristine ng-untouched ng-valid\">\n                <input type=\"hidden\" ng-model=\"user.vkId\" class=\"ng-pristine ng-untouched ng-valid\">\n            </form>\n        </div>\n    </div><!-- .modal-dialog -->\n</div>\n\n\n<!--script type=\"text/javascript\">\n\nindexApp.controller('SignupCtrl', ['$rootScope', '$scope', '$http', '$timeout', '$window',\n    function($rootScope, $scope, $http, $timeout, $window) {\n        var modal = $(\"#signup-modal\"),\n            remindingPass = false;\n\n        // Flag to show that form is tried to be submitted\n        $scope.formSubmitted = false;\n\n        // Variable to add registration done class to popup\n        $scope.regDoneClass = false;\n\n        // Flag to that indicates that entered email is already used\n        $scope.emailIsUsed = false;\n\n        $scope.step = 22;\n\n        // User object\n        $scope.user = {\n            email: '',\n            password: '',\n            firstName: '',\n            lastName: ''\n        };\n\n        $scope.getVkProfile = function() {\n            $scope.loadingVkProfile = true;\n            VK.Auth.login(function(response) {\n                if (window.vkCode != undefined) {\n                    $http.get(\"/user/vk/auth\", {\n                        params: {\n                            code: window.vkCode,\n                            format: 'json'\n                        }\n                    }).success(function(data, status, headers, config) {\n                        if (!data.success) {\n                            alert(\"Unknown error occurred while getting access token. Please try again later or contact administrator.\");\n                            $scope.loadingVkProfile = false;\n                            return;\n                        }\n                        if (data.redirect) {\n                            location.href = data.redirect;\n                            return;\n                        }\n                        $http.get(\"/user/vk/profile?format=json\").success(function(data2, status2, headers2, config2) {\n                            if (!data2.success) {\n                                alert(\"Unknown error occurred while getting profile data. Please try again later or contact administrator.\");\n                                return;\n                            }\n                            $scope.user.vkId = data2.profile.uid;\n                            $scope.user.firstName = data2.profile.first_name;\n                            $scope.user.lastName = data2.profile.last_name;\n                            if (data2.profile.bdate) {\n                                var bdParts = data2.profile.bdate.split('.');\n                                if (bdParts.length == 3) {\n                                    $timeout(function() {\n                                        $scope.$apply(function() {\n                                            var dateField = $('#reg_birthday'), date = new Date(bdParts[2], bdParts[1] - 1, bdParts[0]);\n                                            dateField.datepicker('setDate', date);\n                                            $scope.user.birthday = dateField.val();\n                                        });\n                                    });\n                                }\n\n                            }\n                            if (data2.profile.city) {\n                                $http.get(\"/user/vk/get-city?id=\" + data2.profile.city).success(function(data3) {\n                                    if (data3.success) {\n                                        $scope.user.city = {\n                                            name: data3.city.name,\n                                            cityId: data3.city.id,\n                                            nationId: data3.city.nationId\n                                        };\n                                    }\n                                    $scope.loadingVkProfile = false;\n                                }).\n                                    error(function() {\n                                        $scope.loadingVkProfile = false;\n                                    });\n                            } else {\n                                $scope.loadingVkProfile = false;\n                            }\n                        }).\n                        error(function() {\n                            ($window.mockWindow || $window).alert('Упс! Не удалось получить данные вашего профиля от ВКонтакте (по какой-то технической причине он их нам не вернул). Попробуйте повторить действие еще раз.');\n                            $scope.loadingVkProfile = false;\n                        });\n                    }).\n                    error(function() {\n                        ($window.mockWindow || $window).alert('Упс! Не удалось связаться с ВКонтакте для получения данных вашего профиля. Попробуйте повторить действие еще раз.');\n                        $scope.loadingVkProfile = false;\n                    });\n                } else {\n                    $scope.loadingVkProfile = false;\n                }\n            }, \"offline,wall,status\");\n        };\n\n        $scope.do = function(user) {\n            if ($scope.step == 22) {\n                $(\"#reg_message2\").addClass('hide');\n\n                if (!user.phone || \"\" == user.phone) {\n                    setRowError(\"#reg_phone\", \"Укажите ваш телефон\");\n                    return;\n                }\n                if (user.phone && !user.phone.replace(/[^0-9]/g, \"\").length == 11) {\n                    $(\"#reg_phone\").focus();\n                    setRowError(\"#reg_phone\", \"Некорректный номер телефона\");\n                    return;\n                }\n                if (!user.password || \"\" == user.password) {\n                    setRowError(\"#reg_pass2\", \"Type your password\");\n                    return;\n                }\n                var that = $(\"#user-submit2\");\n                that.button(\"loading\");\n                $http({\n                    method: \"post\",\n                    url: \"/login\",\n                    data: $.param({\n                        email: user.phone,\n                        password: user.password,\n                        vsc: 1,\n                        format: \"json\"\n                    }),\n                    headers: {\n                        'Content-Type': \"application/x-www-form-urlencoded; charset=UTF-8\"\n                    }\n                }).success(function(data, status, headers, config) {\n                    if (data.status) {\n                        location.href = data.returnUrl;\n                    } else {\n                        that.button(\"reset\");\n                        $(\"#reg_message2\").html('<strong>' + data.error + '</strong>').removeClass('hide');\n                    }\n                });\n            } else {\n                $scope.formSubmitted = true;\n                $(\"#reg_message\").addClass('hide');\n\n                if (!user.email || \"\" == user.email) {\n                    setRowError(\"#reg_email\", \"Type your email\");\n                    return;\n                }\n                if (!validateEmail(user.email)) {\n                    $(\"#reg_email\").focus();\n                    setRowError(\"#reg_email\", \"Invalid email\");\n                    return;\n                }\n                if ($scope.emailIsUsed) {\n                    $(\"#card_email\").focus();\n                    return;\n                }\n                if (!user.password || \"\" == user.password) {\n                    setRowError(\"#reg_pass\", \"Type your password\");\n                    return;\n                }\n                if (user.password.length < 6) {\n                    setRowError(\"#reg_pass\", \"Passwords must be at least 6 characters in length.\");\n                    return;\n                }\n                if (\"\" == user.firstName) {\n                    setRowError(\"#reg_fname\", \"Type your first name\");\n                    return;\n                }\n                if (\"\" == user.birthday) {\n                    setRowError(\"#reg_birthday\", \"Enter your birth date\");\n                    return;\n                } else if (!validateRuDate(user.birthday)) {\n                    setRowError(\"#reg_birthday\", \"Valid date format is DD.MM.YYYY\");\n                    return;\n                }\n                if (\"\" == user.lastName) {\n                    setRowError(\"#reg_lname\", \"Type your last name\");\n                    return;\n                }\n                if (\"\" == user.city.name) {\n                    setRowError(\"#reg_city\", \"Type your city\");\n                    return;\n                }\n                user.cityId = user.city.cityId;\n                user.nationId = user.city.nationId;\n\n                $(\"#user-submit\").button(\"loading\");\n                $http({\n                    method: \"post\",\n                    url: \"/signup\",\n                    data: $.param(user),\n                    headers: {\n                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n                        'X-Requested-With': 'XMLHttpRequest'\n                    }\n                }).success(function(data, status, headers, config) {\n                    $(\"#user-submit\").button(\"reset\");\n                    if (data.success) {\n                        $scope.regDoneClass = true;\n\n                        if (data.redirectUrl && $('#after-reg-link').attr('href') == '/members/home') {\n                            $('#after-reg-link').attr('href', data.redirectUrl);\n                        }\n                    } else {\n                        $(\"#reg_message\").html('<strong>' + data.message + '</strong>').removeClass('hide');\n                    }\n                });\n            }\n        };\n\n        modal.on(\"click\", \"#b-reg-remind-pass\", function(e) {\n            e.preventDefault();\n\n            var email = $(\"#reg_email\").val();\n            if (\"\" == email) {\n                return;\n            }\n            if (!validateEmail(email)) {\n                setRowError(\"#reg_email\", \"Invalid email\");\n                return;\n            }\n\n            remindingPass = true;\n            setRowError(\"#reg_email\", \"Wait...\");\n\n            $http({\n                method: \"post\",\n                url: \"/user/auth/forgot\",\n                data: $.param({\n                    format: \"json\",\n                    email: email\n                }),\n                headers: {\n                    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\n                }\n            }).success(function(data, status, headers, config) {\n                if (data.success) {\n                    setRowError(\"#reg_email\", \"Пароль был отправлен, проверьте почту!\");\n                } else {\n                    ($window.mockWindow || $window).alert(data.message);\n                    removeRowError(\"#reg_email\");\n                }\n                remindingPass = false;\n            });\n        });\n\n        var setRowSuccess = function(element) {\n            element = $(element);\n            var container = element.closest(\".wrapperFields\");\n            $(\"input\", container).addClass(\"marked\");\n            $(\".statusMsg\", container).html(\"\");\n            container.removeClass(\"statusFail\").addClass(\"statusOk\");\n        };\n        var setRowError = function(element, message, autoLh) {\n            element = $(element);\n            var container = element.closest(\".wrapperFields\");\n            element.addClass(\"marked\");\n            container.removeClass(\"statusOk\").addClass(\"statusFail\");\n            $(\".statusMsg\", container).html(message).css({lineHeight: autoLh ? \"18px\" : \"\"});\n        };\n        var removeRowError = function(element) {\n            element = $(element);\n            var container = element.closest(\".wrapperFields\");\n            element.removeClass(\"marked\");\n            $(\".statusMsg\", container).html(\"\");\n            container.removeClass(\"statusFail\");\n        };\n        var checkRow1 = function() {\n            if (remindingPass) return;\n\n            var email = $(\"#reg_email\").val(),\n                pass = $(\"#reg_pass\").val();\n            if (\"\" == email) return;\n            if (!validateEmail(email)) setRowError(\"#reg_email\", \"Invalid email\");\n            else removeRowError(\"#reg_email\");\n\n            $http({\n                method: \"post\",\n                url: \"/user/ajax/validate-signup\",\n                data: $.param({\n                    email: email,\n                    format: \"json\"\n                }),\n                headers: {\n                    'Content-Type': \"application/x-www-form-urlencoded; charset=UTF-8\"\n                }\n            }).success(function(data, status, headers, config) {\n                if (\"used\" == data.status) {\n                    $scope.emailIsUsed = true;\n                    setRowError(\"#reg_email\", \"Email is used. \"\n                    + \"<br><a id=\\\"b-reg-remind-pass\\\" class=\\\"b-remind-pass\\\" ng-click=\\\"remindPass()\\\">Напомнить мой пароль!</a>\", true);\n                } else {\n                    $scope.emailIsUsed = false;\n                    if (\"\" != pass) setRowSuccess(\"#reg_pass\");\n                }\n            });\n        };\n        var checkRow2 = function() {\n            var firstName = $(\"#reg_fname\").val(),\n                lastName = $(\"#reg_lname\").val();\n            if (\"\" == firstName) return;\n            if (\"\" == lastName) return;\n            setRowSuccess(\"#reg_fname\");\n        };\n\n        $(\"#reg_email\").on(\"blur\", checkRow1);\n        $(\"#reg_pass\").on(\"blur\", function() {\n            if ($scope.emailIsUsed) return;\n            checkRow1();\n        });\n\n        $(\"#reg_fname\").on(\"blur\", checkRow2);\n        $(\"#reg_lname\").on(\"blur\", checkRow2);\n\n        ymaps.ready(function(){\n            $http.get(\"/ajax/findbycoords.php\", {\n                params: {\n                    latitude: ymaps.geolocation.latitude,\n                    longitude: ymaps.geolocation.longitude,\n                    locale: \"en\"\n                }\n            }).success(function(data, status, headers, config) {\n                var cityParts = data.value.split(',');\n                $scope.user.city = {\n                    name: cityParts[0] + \", \" + cityParts[2],\n                    cityId: data.id,\n                    nationId: data.nation\n                };\n            });\n        });\n\n        if (\"#signup-modal\" == location.hash) {\n            modal.modal(\"show\");\n        }\n\n        $(\"body\").on(\"vk.login.fail.notConnected\", function(e, vkId, firstName, lastName) {\n            $scope.$apply(function() {\n                $scope.user.vkId = vkId;\n                $scope.user.firstName = firstName;\n                $scope.user.lastName = lastName;\n            });\n            modal.modal(\"show\");\n        });\n\n        modal.on(\"show.bs.modal\", function() {\n            var helper = function() {\n                $scope.step = 22;\n            };\n            if ($rootScope.$$phase) {\n                $scope.$eval(helper);\n            } else {\n                $scope.$apply(helper);\n            }\n        });\n\n        $scope.goToStep = function(step) {\n            $scope.step = step;\n        };\n    }]);\n\n</script--><div id=\"cardreg-modal\" class=\"modal fade\" role=\"dialog\" aria-hidden=\"true\" tabindex=\"-1\">\n    <div class=\"modal-dialog\">\n        <div class=\"b-popup-registration b-popup_reg\" style=\"position: relative\">\n            <fieldset>\n                <div class=\"b-popup__close\" data-dismiss=\"modal\" aria-hidden=\"true\">×</div>\n\n                <div class=\"b-popup__regBlock\" style=\"height:40px\">\n                    <h4 class=\"b-popup__title\">\n                        <span class=\"wrapper\">SIGN UP</span>\n                    </h4>\n                </div>\n\n                <div class=\"b-popup__body\" style=\"background-color:#fff;padding-top: 0;\">\n                    <iframe id=\"cardreg-modal-cont\" style=\"border:0;padding:0;margin:0;width:100%;height:300px;\"></iframe>\n                </div>\n            </fieldset>\n        </div>\n    </div><!-- .modal-dialog -->\n</div></div>            </div>\n\n        </div>\n    </div>\n\n            <div id=\"home_bg\" class=\"scroll_fix\" style=\"width: 784px;\"></div>\n    \n    \n    <div class=\"page-bg\"></div>\n\n        \n            <!-- Piwik -->\n        <script type=\"text/javascript\">\n            var _paq = _paq || [];\n            _paq.push(['trackPageView']);\n            _paq.push(['enableLinkTracking']);\n            (function() {\n                var u=\"//app.goalstream.org/\";\n                _paq.push(['setTrackerUrl', u+'piwik.php']);\n                _paq.push(['setSiteId', 1]);\n                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n                g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);\n            })();\n        </script>\n        <noscript>&lt;p&gt;&lt;img src=\"//app.goalstream.org/piwik.php?idsite=1\" style=\"border:0;\" alt=\"\"&gt;&lt;/p&gt;</noscript>\n        <!-- End Piwik Tracking Code -->\n    \n<div id=\"vk_api_transport\"><script type=\"text/javascript\" src=\"http://vkontakte.ru/js/api/openapi.js\" async=\"\"></script></div></body>"}
